{% extends "base.html" %}

{% block content %}
<div style="padding: 20px;">
    
    <div style="margin-bottom: 20px;">
        <h2>Listado de Socios y Préstamos</h2>
        
        {% if current_user.role == 'admin' %}
            <a href="{{ url_for('socios.crear') }}">
                + Crear Nuevo Socio
            </a>
        {% endif %}
    </div>

    <table border="1" style="width: 100%; border-collapse: collapse; text-align: left;">
        <thead>
            <tr style="background-color: #f0f0f0;">
                <th style="padding: 8px;">Código</th>
                <th style="padding: 8px;">Nombre</th>
                <th style="padding: 8px;">Email</th>
                <th style="padding: 8px;">Estado Préstamo</th>
            </tr>
        </thead>
        <tbody>
            {% for socio in socios %}
                <tr>
                    <td style="padding: 8px;">{{ socio.id }}</td> 
                    <td style="padding: 8px;">{{ socio.nombre }}</td>
                    <td style="padding: 8px;">{{ socio.email }}</td>
                    <td style="padding: 8px;">
                        {% if socio.libro_prestado %}
                            <strong>{{ socio.libro_prestado.titulo }}</strong>
                            <br>
                            
                            {% if current_user.role == 'admin' %}
                                <a href="{{ url_for('prestamos.devolver', socio_id=socio.id) }}" 
                                    style="color: red;"
                                    onclick="return confirm('¿Confirmar devolución del libro?');">
                                    [Devolver Libro]
                                </a>
                            {% endif %}
                            
                        {% else %}
                            <span style="color: grey;">Sin préstamos</span>
                        {% endif %}
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4" style="padding: 8px; text-align: center;">
                        No hay socios registrados.
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

</div>
{% endblock %}